<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="/assets/circle.png" type="image/png">
    <title>Edit Produk | Plastiqu.Co</title>
    <link rel="stylesheet" href="/css/produkte.css">

    <!-- Google fonts signika -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Signika:wght@300..700&display=swap" rel="stylesheet">

    <!-- FA Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Form Edit Produk -->
    <div class="form-container">
        <form id="editProductForm" action="#" method="POST">
            <!-- Header with logo and "Edit Produk" -->
            <div class="brand">
                <img src="/assets/logo_only_vector.png" alt="Logo">
                <span class="text-center">Plastiqu.Co</span>
            </div>
            <h2 class="text-center">Edit Produk</h2>

            <!-- Kategori dan Nama Produk (Sejajar) -->
            <div class="input-row">
                <!-- Kategori Dropdown -->
                <div class="input-group">
                    <select id="productCategory" required>
                        <option value="" disabled selected>Pilih Kategori</option>
                        <option value="Plastik Makanan">Plastik Makanan</option>
                        <option value="Plastik Minuman">Plastik Minuman</option>
                        <option value="Kemasan Kertas">Kemasan Kertas</option>
                    </select>
                    <label for="productCategory">Kategori</label>
                </div>

                <!-- Nama Produk -->
                <div class="input-group">
                    <input type="text" id="productName" required>
                    <label for="productName">Nama Produk</label>
                </div>
            </div>

            <!-- Deskripsi Produk -->
            <div class="input-group">
                <textarea id="productDescription" required></textarea>
                <label for="productDescription">Deskripsi Produk</label>
            </div>

            <!-- Varian Produk -->
            <div id="variantsContainer">
                <h3>Varian Produk</h3>
                <div class="variant-input-group">
                    <input type="text" placeholder="Varian" required>
                    <input type="number" placeholder="Stok" required>
                    <input type="number" placeholder="Harga (Range)" required>
                </div>
            </div>
            <a href="#" id="addVariantLink" class="add-variant-link">Tambah Varian</a>

            <!-- Gambar Produk -->
            <div class="input-group">
                <input type="file" id="productImage" accept="image/*" required>
                <label for="productImage">Gambar Produk</label>
                <img id="imagePreview" src="" alt="Preview Gambar" style="display:none;">
                <small style="color: #999; margin-top: 5px; display: block;">* Pilih gambar produk untuk preview</small>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="submit-btn">Simpan</button>

            <!-- Cancel Button -->
            <div class="cancel-btn-container">
                <a href="produk.html" class="cancel-btn">
                    <i class="fa-solid fa-circle-xmark"></i>
                </a>
            </div>
        </form>
    </div>

    <script>
        // Fungsi untuk menambahkan input varian baru
        document.getElementById('addVariantLink').addEventListener('click', function(event) {
            event.preventDefault(); // Menghindari navigasi
            const variantsContainer = document.getElementById('variantsContainer');
            const newVariant = document.createElement('div');
            newVariant.classList.add('variant-input-group');
            newVariant.innerHTML = `
                <input type="text" placeholder="Varian" required>
                <input type="number" placeholder="Stok" required>
                <input type="number" placeholder="Harga (Range)" required>
            `;
            variantsContainer.appendChild(newVariant);
        });

        // Fungsi untuk menyimpan perubahan produk
        document.getElementById('editProductForm').onsubmit = async function(event) {
            event.preventDefault();
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const newProduct = {
                category: document.getElementById('productCategory').value,
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                variants: []
            };

            // Mengambil data varian
            const variantGroups = document.querySelectorAll('.variant-input-group');
            variantGroups.forEach(variant => {
                const variantName = variant.children[0].value;
                const variantStock = variant.children[1].value;
                const variantPrice = variant.children[2].value;
                newProduct.variants.push({
                    name: variantName,
                    stock: variantStock,
                    price: variantPrice
                });
            });

            // Menambahkan gambar
            const imageFile = document.getElementById('productImage').files[0];
            if (imageFile) {
                newProduct.image = await getBase64(imageFile);
            }

            // Simpan produk ke localStorage
            products.push(newProduct);
            localStorage.setItem('products', JSON.stringify(products));
            alert('Produk berhasil diupdate!');
            window.location.href = 'produk.html'; // Arahkan ke halaman produk
        };

        // Fungsi untuk mengonversi gambar ke Base64
        function getBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Menampilkan preview gambar saat dipilih
        document.getElementById('productImage').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const imagePreview = document.getElementById('imagePreview');
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block'; // Menampilkan gambar preview
            };
            reader.readAsDataURL(file);
        });
    </script>
</body>

</html>
